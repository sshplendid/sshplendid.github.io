---
layout: post
title: '정규표현식은 애플리케이션을 멋지게 한다.'
date: 2020-03-16 23:45:10 +0900
categories: [blog, dev]
img: ''
img-link: ''
img-description: ''
tags: [fluentd, log, java]
---

최근 마켓컬리 기술블로그에 [정규표현식 관련 포스트](https://helloworld.kurly.com/blog/reg-exp-01/)가 올라왔는데 때마침 나 역시 정규표현식과 관련된 작업이 있어 기록을 남겨보려고 한다.

## 로그를 정규표현식으로 쪼개보아요.

우리의 애플리케이션은 [Fluentd](https://www.fluentd.org/)를 사용해서 로그를 수집하고 Elastic Search에 올려 키바나로 분석하고 있다. 키바나로 로그를 보는 것은 처음이라 아직 익숙하진 않기도 하면서 한 가지 아쉬운 점이 있는데 로그가 보기 힘들다는 것이다. 시간의 역순으로 나와서 어색하기도 하고 로그가 너무 길다. 모든게 두 줄 이상으로 나오는 것이다. 이유는... 쓰레드, 로거, 메시지, MDC 등의 많은 정보가 모두 하나의 필드에 담겨있기 때문이다. 왜 이렇게 나올까? 로그 관련 담당자에게 물어보니 "Fluentd의 Regexp 플러그인을 사용해서 쪼개보려고 했는데 잘 안됐다"는 답변을 받았다. 아마 정규표현식에 익숙하지 않거나 다른 바쁜일도 있었겠지 생각하면서 괜찮다면 내가 작업해도 괜찮겠냐고 물었고 해도 된다는 답변을 받았다. 아무래도 내가 담당하는 일이 아니다보니 조심스러워진다.

담당자에게 Fluentd 설정파일과 프로젝트에서 사용하는 logback 설정파일을 받았다. 지금와서 생각해보면 제일 간단한 방법은 logback 레이아웃을 처음부터 json 형식으로 받는거다. 그럼 정규표현식을 굳이 쓰지 않아도 되고 파싱도 안할수도 있을 것이다. 그런데 이미 프로젝트가 많이 진행된 시점이고 애플리케이션 개수만 백여개가 넘어간다. 다시 레이아웃을 변경한다고 공지해도 모두 바뀌는데는 시간이 걸릴 것이다.



##현